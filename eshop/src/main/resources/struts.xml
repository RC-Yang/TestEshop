<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE struts PUBLIC
	"-//Apache Software Foundation//DTD Struts Configuration 2.1//EN"
	"http://struts.apache.org/dtds/struts-2.1.dtd">
<struts>
	<!-- struts設定檔內package，必須繼承struts-default package，故必須include struts-default.xml -->
	<include file="struts-default.xml" />

	<!-- 繼承 struts-default package，也就是繼承既有的攔截器 
		Struts 2是攔截器驅動-->
	<package name="default" extends="struts-default">
	
		<!-- 自訂攔截器與攔截器集合 -->
		<interceptors>
			<interceptor name="authenticationInterceptor"
				class="com.example.interceptor.AuthenticationInterceptor" />

			<interceptor-stack name="globalStack">
				<interceptor-ref name="authenticationInterceptor" />
				<interceptor-ref name="fileUpload" />
				<!-- struts.xml註冊modelDrivenStack，表示宣告要使用這個攔截器集合(modelDriven+basicStack)，
				凡是攔截到有model的action，其model都要推到valueStack頂端、且model可以被basicStack內的parameters攔截器賦值 -->
				<!-- basicStack來自struts-default package -->
				<interceptor-ref name="modelDrivenStack" />
			</interceptor-stack>

		</interceptors>

		<!-- 設定所有屬於該package的action，預設使用的攔截器堆疊 -->
		<default-interceptor-ref name="globalStack" />

		<global-results>
			<result name="login" type="redirect">
				/login.jsp
			</result>
			<result name="error" type="redirect">/error.jsp</result>
		</global-results>

        <!-- 任何 Action 如果在執行過程中拋出了 java.lang.Exception（或其子類別），
        而且沒有被捕捉處理，就會直接轉到result="error" -->
		<global-exception-mappings>
			<exception-mapping exception="java.lang.Exception"
				result="error" />
		</global-exception-mappings>
	</package>
	
	<!-- 註解：include 不是將內容插入，而是解析並載入另一個配置檔 -->
    <include file="struts/struts-login.xml"/><!-- 這是相對於classpath的相對路徑 -->
    <include file="struts/struts-register.xml"/>
    <include file="struts/struts-home.xml"/>
    <include file="struts/struts-product.xml"/>
    <include file="struts/struts-cart.xml"/>
    <include file="struts/struts-purchase.xml"/>
    <include file="struts/struts-order.xml"/>
    
    <constant name="struts.multipart.maxSize" value="2097152000" />

</struts>
